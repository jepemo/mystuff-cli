<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@{{ author }}</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <h1>Learning</h1>

    <nav>
      <a href="index.html">Home</a> | <a href="learning.html">Learning</a> |
      <a href="links.html">Links</a>{% if menu_items %}{% for item in menu_items %} | 
      <a href="{{ item.url }}"{% if item.url.startswith('http') %} target="_blank"{% endif %}>{{ item.name }}</a>{% endfor %}{% endif %}
    </nav>

    <main>
      <p>Structured learning materials and notes organized by topic.</p>

      <form action="#" method="get">
        <label for="search">Search lessons:</label>
        <input
          type="search"
          id="search"
          name="search"
          placeholder="Type to search..."
        />

        <label for="filter">Status:</label>
        <select id="filter" name="filter">
          <option value="all">All Lessons</option>
          <option value="current">Current</option>
          <option value="done">Done</option>
          <option value="todo">To Do</option>
        </select>

        <label for="general-topic-filter">General Topic:</label>
        <select id="general-topic-filter" name="general-topic-filter">
          <option value="all">All Topics</option>
        </select>

        <label for="difficulty-filter">Difficulty:</label>
        <select id="difficulty-filter" name="difficulty-filter">
          <option value="all">All Levels</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </form>

      {% if lessons %}
      <h2>Lessons ({{ lessons|length }} total)</h2>
      <ul>
        {% for lesson in lessons %}
        <li data-topic="{{ lesson.topic|default('') }}" data-status="{{ lesson.status|default('') }}" data-general-topic="{{ lesson.general_topic|default('') }}" data-difficulty="{{ lesson.difficulty|default('') }}">
          <strong><a href="{{ lesson.url }}">{{ lesson.display_title|default(lesson.title) }}</a></strong>
          {% if lesson.status %} {% if lesson.status == 'done' %} [DONE]{% endif %} {%
          if lesson.status == 'current' %} [CURRENT]{% endif %} {% if
          lesson.status == 'todo' %} [TODO]{% endif %} {% endif %} {% if
          lesson.description %}
          <br />{{ lesson.description }} {% endif %}
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>
        No lessons found. Add some markdown files to your learning directory.
      </p>
      {% endif %}
    </main>

    <script>
      // Simple search and filter functionality
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("search");
        const filterSelect = document.getElementById("filter");
        const generalTopicFilter = document.getElementById("general-topic-filter");
        const difficultyFilter = document.getElementById("difficulty-filter");
        const lessonItems = document.querySelectorAll("main ul li");

        // Populate general topic filter options dynamically
        function populateGeneralTopicFilter() {
          const generalTopics = new Set();
          lessonItems.forEach(function (item) {
            const generalTopic = item.getAttribute("data-general-topic");
            if (generalTopic && generalTopic.trim() !== "") {
              generalTopics.add(generalTopic);
            }
          });
          
          // Add unique general topics to the filter
          generalTopics.forEach(function (topic) {
            const option = document.createElement("option");
            option.value = topic.toLowerCase();
            option.textContent = topic;
            generalTopicFilter.appendChild(option);
          });
        }

        function filterLessons() {
          const searchTerm = searchInput.value.toLowerCase();
          const filterValue = filterSelect.value;
          const generalTopicValue = generalTopicFilter.value;
          const difficultyValue = difficultyFilter.value;

          lessonItems.forEach(function (item) {
            const text = item.textContent.toLowerCase();
            const itemStatus = item.getAttribute("data-status") || "";
            const itemGeneralTopic = (item.getAttribute("data-general-topic") || "").toLowerCase();
            const itemDifficulty = (item.getAttribute("data-difficulty") || "").toLowerCase();
            
            const matchesSearch = text.includes(searchTerm);
            
            let matchesStatusFilter = true;
            if (filterValue !== "all") {
              matchesStatusFilter = itemStatus === filterValue;
            }

            let matchesGeneralTopicFilter = true;
            if (generalTopicValue !== "all") {
              matchesGeneralTopicFilter = itemGeneralTopic === generalTopicValue;
            }

            let matchesDifficultyFilter = true;
            if (difficultyValue !== "all") {
              matchesDifficultyFilter = itemDifficulty === difficultyValue;
            }

            if (matchesSearch && matchesStatusFilter && matchesGeneralTopicFilter && matchesDifficultyFilter) {
              item.style.display = "list-item";
            } else {
              item.style.display = "none";
            }
          });
        }

        // Initialize general topic filter
        populateGeneralTopicFilter();

        searchInput.addEventListener("input", filterLessons);
        filterSelect.addEventListener("change", filterLessons);
        generalTopicFilter.addEventListener("change", filterLessons);
        difficultyFilter.addEventListener("change", filterLessons);
      });
    </script>

    <hr>
    <footer>
        <p>Generated on {{ generated_at }} | @{{ author }} | Built with <a href="https://github.com/jepemo/mystuff-cli" target="_blank">mystuff-cli</a></p>
    </footer>
  </body>
</html>
